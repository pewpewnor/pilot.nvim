*pilot.txt*     Run your projects and files with powerful command placeholders

==============================================================================
Table of Contents                                    *pilot-table-of-contents*

  - Motivation                                              |pilot-motivation|
  - Features                                                  |pilot-features|
  - Installation                                          |pilot-installation|
  - General Terms                                        |pilot-general-terms|
  - Default Configuration Values          |pilot-default-configuration-values|
  - Configuration Options                        |pilot-configuration-options|
  - Example Configuration                        |pilot-example-configuration|
  - Run Configuration Format                  |pilot-run-configuration-format|
  - Example Project Run Configuration|pilot-example-project-run-configuration|
  - Example File Type Run Configuration|pilot-example-file-type-run-configuration|
  - Placeholders                                          |pilot-placeholders|
  - Preset Executors                                  |pilot-preset-executors|
  - Functions                                                |pilot-functions|
  - Tips & Recommendations                      |pilot-tips-&-recommendations|
  - Links                                                        |pilot-links|
  - Contributing                                          |pilot-contributing|
  - FAQ                                                            |pilot-faq|


A Neovim plugin that allows you to **run** your **project or file** based on a
**JSON run configuration file** with placeholder support and customizable
executors. You can edit configurations on the fly, and the plugin supports
advanced features like fallback configs, custom executors, and more.

This plugin requires Neovim v0.11.0 at the minimum. We always strive to use the
latest Neovim major release version.

The source code for this plugin is available in the GitHub repository
<https://github.com/pewpewnor/pilot.nvim>.

------------------------------------------------------------------------------

MOTIVATION                                                  *pilot-motivation*

I wanted a code runner plugin that supports placeholder interpolation, allowing
me to use a single keystroke to compile, build, and run my code at the same
time, whilst still having full control over the commands.

------------------------------------------------------------------------------

FEATURES                                                      *pilot-features*

- **Run arbitrary commands** for any file or project, with full control over execution.
- **Placeholder interpolation** for file paths, names, directories, and more.
- **On-the-fly configuration editing**: No need to reload Neovim after changes.
- **Fallback project run configuration**: Use a default config if none is found for a project.
- **Customizable config file locations**: Store configs wherever you want.
- **Customizable executors**: Run commands in new tabs, splits, vsplits, background jobs, or your own custom way.
- **Custom executors**: Define your own ways to run commands, including integration with tools like tmux.
- **UI selection**: If multiple commands are available, select which to run via `vim.ui.select`.
- **Automatic single-command execution**: Optionally auto-run if only one command is available.
- **Purge/delete config files**: Easily remove or reset run configurations.
- **Import other config files**: Use `"import"` in your JSON to include commands from other files.
- **JSON validation and helpful errors**: Clear error messages for misconfigured files.
- **Template writing**: Optionally auto-generate a template when creating a new config file.
- **Full Lua API**: All features are accessible programmatically.

------------------------------------------------------------------------------

INSTALLATION                                              *pilot-installation*

Using lazy.nvim <https://github.com/folke/lazy.nvim>:

>lua
    return {
        "pewpewnor/pilot.nvim",
        opts = {},
    }
    -- or
    return {
        "pewpewnor/pilot.nvim",
        config = function()
            require("pilot").setup()
        end,
    }
<

Using packer.nvim <https://github.com/wbthomason/packer.nvim>:

>lua
    use {
        "pewpewnor/pilot.nvim",
        config = function()
            require("pilot").setup()
        end
    }
<

------------------------------------------------------------------------------

GENERAL TERMS                                            *pilot-general-terms*

- **Project run configuration**: JSON file containing commands to run for the current project.
- **File type run configuration**: JSON file containing commands to run for the current file type.

------------------------------------------------------------------------------

DEFAULT CONFIGURATION VALUES              *pilot-default-configuration-values*

You do not need to pass anything to `setup()` if you want the defaults.

>lua
    {
        run_config_path = {
            project = "{{pilot_data_path}}/projects/{{hash(cwd_path)}}.json", -- string | string[]
            file_type = "{{pilot_data_path}}/filetypes/{{file_type}}.json", -- string
            fallback_project = nil, -- (function() -> string) | nil
        },
        automatically_run_single_command = {
            project = true, -- boolean
            file_type = true, -- boolean
        },
        write_template_to_new_run_config = true, -- boolean
        default_executor = {
            project = pilot.preset_executors.new_tab, -- function(command: string)
            file_type = pilot.preset_executors.new_tab, -- function(command: string)
        },
        executors = {
            new_tab = pilot.preset_executors.new_tab,
            current_buffer = pilot.preset_executors.current_buffer,
            split = pilot.preset_executors.split,
            vsplit = pilot.preset_executors.vsplit,
            print = pilot.preset_executors.print,
            silent = pilot.preset_executors.silent,
            background_silent = pilot.preset_executors.background_silent,
            background_exit_status = pilot.preset_executors.background_exit_status,
        }, -- table<string, function(command: string, args: string[])>
    }
<

------------------------------------------------------------------------------

CONFIGURATION OPTIONS                            *pilot-configuration-options*


RUN_CONFIG_PATH.PROJECT ~

- **Type:** `string | string[] | nil`
- **Default:** `nil` (internally resolves to `{{pilot_data_path}}/projects/{{hash(cwd_path)}}.json`)
- **Description:**
    Path or list of paths to the project run configuration file(s).
    If a list, the first readable file is used.
    Supports placeholders (see |pilot-placeholders|).
- **Example:**
    `"{{cwd_path}}/pilot.json"`
    `{ "{{cwd_path}}/pilot.json", "{{cwd_path}}/.pilot.json" }`


RUN_CONFIG_PATH.FILE_TYPE ~

- **Type:** `string | nil`
- **Default:** `nil` (internally resolves to `{{pilot_data_path}}/filetypes/{{file_type}}.json`)
- **Description:**
    Path to the file type run configuration file.
    Supports placeholders.


RUN_CONFIG_PATH.FALLBACK_PROJECT ~

- **Type:** `function() -> string | nil`
- **Default:** `nil`
- **Description:**
    Function returning a path to a fallback config file if the main one is missing.
    Useful for providing a default config for certain project types.


AUTOMATICALLY_RUN_SINGLE_COMMAND.PROJECT ~

- **Type:** `boolean`
- **Default:** `true`
- **Description:**
    If only one command is found in the project run config, run it immediately without prompting the user.


AUTOMATICALLY_RUN_SINGLE_COMMAND.FILE_TYPE ~

- **Type:** `boolean`
- **Default:** `true`
- **Description:**
    If only one command is found in the filetype run config, run it immediately without prompting the user.


WRITE_TEMPLATE_TO_NEW_RUN_CONFIG ~

- **Type:** `boolean`
- **Default:** `true`
- **Description:**
    If true, writes a JSON template when creating a new config file (when editing a config that does not exist).


DEFAULT_EXECUTOR.PROJECT ~

- **Type:** `function(command: string) -> string`
- **Default:** `nil` (internally resolves to `pilot.preset_executors.new_tab`)
- **Description:**
    The default executor function used to run commands which have no specified `executor` in the project run config.
    See |pilot-preset-executors| for available executors and their signatures.


DEFAULT_EXECUTOR.FILE_TYPE ~

- **Type:** `function(command: string) -> string`
- **Default:** `nil` (internally resolves to `pilot.preset_executors.new_tab`)
- **Description:**
    The default executor function used to run commands which have no specified `executor` in the filetype run config.
    See |pilot-preset-executors| for available executors and their signatures.


EXECUTORS ~

- **Type:** `table<string, function(command: string, args: string[])>`
- **Default:** `{}`
- **Description:**
    Table mapping executor names to executor functions.
    Used when a run config entry specifies a `"executor"` field.
    The executor function receives two arguments:
    - `command` (string): The shell command to run (with placeholders already expanded).
    - `args` (list of strings): The result from splitting the string that was written in the `executor` with whitespaces as the seperator and without the executor name (first argument) inside the list.

------------------------------------------------------------------------------

EXAMPLE CONFIGURATION                            *pilot-example-configuration*

>lua
    local pilot = require("pilot")
    pilot.setup({
        run_config_path = {
            project = "{{cwd_path}}/pilot.json",
            fallback_project = function()
                if vim.fn.filereadable(vim.fn.getcwd() .. "/package-lock.json") == 1 then
                    return  "{{pilot_data_path}}/npm_project.json"
                elseif vim.fn.filereadable(vim.fn.getcwd() .. "/CMakeLists.txt") == 1 then
                    return "/home/user/templates/cmake_project.json"
                end
            end,
        },
        default_executor = {
            file_type = pilot.preset_executors.split,
        },
        executors = {
            tmux_new_window = function(command, args)
                vim.fn.system("tmux new-window -d")
                vim.fn.system("tmux send-keys -t +. '" .. command .. "' Enter")
            end,
            background = pilot.preset_executors.background_exit_status,
        },
        write_template_to_new_run_config = false,
    })
    
    vim.keymap.set("n", "<F10>", pilot.run_project)
    vim.keymap.set("n", "<F12>", pilot.run_file_type)
    vim.keymap.set("n", "<F11>", pilot.run_previous_task)
    vim.keymap.set("n", "<Leader><F10>", pilot.edit_project_run_config)
    vim.keymap.set("n", "<Leader><F12>", pilot.edit_file_type_run_config)
    
    vim.api.nvim_create_user_command("PilotDeleteProjectRunConfig",
        pilot.delete_project_run_config, { nargs = 0, bar = false })
    vim.api.nvim_create_user_command("PilotDeleteFileTypeRunConfig",
        pilot.delete_file_type_run_config, { nargs = 0, bar = false })
<

------------------------------------------------------------------------------

RUN CONFIGURATION FORMAT                      *pilot-run-configuration-format*

Both project and file type run configurations use the same JSON format: an
array of entries.

Each entry can be:

- A **string** (the command to run)
- An **object** with fields:
    - `name` (optional): Display name for the command.
    - `command`: String or array of strings (joined with `&&`).
    - `executor` (optional): Name of an executor that exists in |pilot-executors|.
    - `import` (optional): Path to another JSON file to import entries from.
        Imported entries are merged in place.

------------------------------------------------------------------------------

EXAMPLE PROJECT RUN CONFIGURATION    *pilot-example-project-run-configuration*

>json
    [
        {
            "name": "build & run project",
            "command": "make build && make run"
        },
        {
            "name": "run hovered test function name",
            "command": "go test -v --run {{cword}}"
        },
        {
            "command": ["ls {{dir_path}}", "touch 'hello world.txt'"],
            "executor": "tmux_new_window"
        },
        "echo Hello, World!"
    ]
<


  **Tip:** Use the mustache syntax like `{{cword}}` to insert a placeholder that
  will automatically be replaced by pilot.nvim on the fly!
------------------------------------------------------------------------------

EXAMPLE FILE TYPE RUN CONFIGURATION*pilot-example-file-type-run-configuration*

Let’s say you want to write a file type run configuration for compiling and
running C source code files.

>json
    [
        {
            "name": "clang",
            "command": "clang {{file_path_relative}} && ./a.out"
        },
        "gcc {{file_path}} -o {{file_name_no_extension}} ; ./{{file_name_no_extension}}"
    ]
<


  **Tip:** For each entry, you don’t have to specify a display name if you want
  it to be the same as the raw command string. You can also instead use a string
  for defining an entry/command.
**Importing/Including Existing Run Configuration:**

>json
    [{ "import": "{{pilot_data_path}}/common_commands.json" }]
<

------------------------------------------------------------------------------

PLACEHOLDERS                                              *pilot-placeholders*

All placeholders are expanded in config paths and commands. You can escape a
placeholder by using triple braces, e.g. `{{{not_a_placeholder}}}`.

  --------------------------------------------------------------------------
  Placeholder                  Resolved value
  ---------------------------- ---------------------------------------------
  {{file_path}}                Current buffer’s absolute file path

  {{file_path_relative}}       File path relative to current working
                               directory

  {{file_name}}                File name (with extension)

  {{file_name_no_extension}}   File name without extension

  {{file_type}}                Filetype of current buffer (vim.bo.filetype)

  {{file_extension}}           File extension

  {{dir_path}}                 Directory containing the current buffer

  {{dir_name}}                 Name of the directory containing the current
                               buffer

  {{cwd_path}}                 Absolute path of the current working
                               directory

  {{cwd_name}}                 Name of the current working directory

  {{pilot_data_path}}          Path to vim.fn.stdpath("data") .. "/pilot"

  {{cword}}                    Word under the cursor

  {{cWORD}}                    WORD under the cursor

  {{hash(cwd_path)}}           SHA256 hash of the current working directory
                               path

  {{hash(file_path)}}          SHA256 hash of the current buffer’s absolute
                               path
  --------------------------------------------------------------------------
------------------------------------------------------------------------------

PRESET EXECUTORS                                      *pilot-preset-executors*

Executors are functions that run the command in a specific way. All executors
receive two arguments:

- `command` (string): The shell command to run (with placeholders already expanded).
- `args` (table): List of arguments (see |pilot-executors|).


BUILT-IN EXECUTORS ~

  --------------------------------------------------------------------------------------------------------------
  Executor                                        Description                                             
  ----------------------------------------------- ------------------------------------------------------- ------
  pilot.preset_executors.new_tab (default)        Run the command in a new Neovim tab. Uses               
                                                  :tabnew                              | term <cmd>.      

  pilot.preset_executors.current_buffer           Run the command in the current buffer (replaces buffer  
                                                  with terminal).                                         

  pilot.preset_executors.split                    Run the command in a new horizontal split               
                                                  (:split                              | term <cmd>).     

  pilot.preset_executors.vsplit                   Run the command in a new vertical split                 
                                                  (:vsplit                               | term <cmd>).   

  pilot.preset_executors.print                    Run the command and print output to a message           
                                                  (blocking, uses vim.fn.system).                         

  pilot.preset_executors.silent                   Run the command silently (blocking, no output shown).   

  pilot.preset_executors.background_silent        Run the command as a background job (no output, uses    
                                                  vim.fn.jobstart).                                       

  pilot.preset_executors.background_exit_status   Run as background job, print exit status on completion. 
  --------------------------------------------------------------------------------------------------------------

CUSTOM EXECUTORS ~

You can define your own executor functions and add them to `executors`. The
executor function signature is:

>lua
    function(command: string, args: string[])
        -- implementation
    end
<

**Example:**

>lua
    executors = {
        tmux_new_window = function(command, args)
            vim.fn.system("tmux new-window -d")
            vim.fn.system("tmux send-keys -t +. '" .. command .. "' Enter")
        end,
        vsplit = require("pilot").executors.vsplit,
    }
<

------------------------------------------------------------------------------

FUNCTIONS                                                    *pilot-functions*

All functions are available via `require("pilot")`.

  ----------------------------------------------------------------------------------------------
  Function Name                                  Description
  ---------------------------------------------- -----------------------------------------------
  setup(options)                                 Configure pilot.nvim. See configuration options
                                                 (detailed).

  run_project()                                  Run a project command (from project run
                                                 config). Prompts if multiple commands.

  run_file_type()                                Run a file type command (from file type run
                                                 config). Prompts if multiple commands.

  run_previous_task()                            Re-run the last executed task (project or file
                                                 type).

  edit_project_run_config()                      Open the project run config for editing
                                                 (creates template if missing).

  edit_file_type_run_config()                    Open the file type run config for editing
                                                 (creates template if missing).

  delete_project_run_config()                    Delete the current project run config file.

  delete_file_type_run_config()                  Delete the current file type run config file.

  purge_all_default_project_run_config_dir()     Delete all default project run config files (in
                                                 {{pilot_data_path}}/projects).

  purge_all_default_file_type_run_config_dir()   Delete all default file type run config files
                                                 (in {{pilot_data_path}}/filetypes).
  ----------------------------------------------------------------------------------------------
------------------------------------------------------------------------------

TIPS & RECOMMENDATIONS                          *pilot-tips-&-recommendations*

- Use telescope-ui-select.nvim <https://github.com/nvim-telescope/telescope-ui-select.nvim> or mini.nvim’s mini-pick <https://github.com/echasnovski/mini.nvim/blob/main/readmes/mini-pick.md> for a better `vim.ui.select()` experience.
- You can import common commands into multiple configs using the `"import"` key.
- Placeholders can be escaped by using extra braces, e.g. `{{{not_a_placeholder}}}`.
- To disable template writing for new configs, set `write_template_to_new_run_config = false`.
- All config files are validated on load; errors are shown in the command line.

------------------------------------------------------------------------------

LINKS                                                            *pilot-links*

- GitHub discussions <https://github.com/pewpewnor/pilot.nvim/discussions>
- telescope-ui-select.nvim <https://github.com/nvim-telescope/telescope-ui-select.nvim>
- mini.nvim’s mini-pick <https://github.com/echasnovski/mini.nvim/blob/main/readmes/mini-pick.md>
- Neovim <https://neovim.io/>
- Lua <https://www.lua.org/>

------------------------------------------------------------------------------

CONTRIBUTING                                              *pilot-contributing*

See CONTRIBUTING.md <../CONTRIBUTING.md> for guidelines.

------------------------------------------------------------------------------

FAQ                                                                *pilot-faq*

**Q: How do I add a new executor?** A: Add a function to `executors` in your
config and reference its key in your run config’s `"executor"`.

**Q: How do I use placeholders in config paths?** A: All config paths support
placeholders like `{{cwd_path}}`, `{{file_type}}`, etc.

**Q: What happens if my config file is missing or invalid?** A: For project
configs, the fallback function is used if provided. For file type configs, a
message is printed and nothing runs.

**Q: Can I use arrays for the command field?** A: Yes, arrays are joined with
`&&` to form a single shell command.

**Q: What is passed to custom executors?** A: Both the expanded command string
and an `arg` string (see |pilot-preset-executors|).

------------------------------------------------------------------------------

Generated by panvimdoc <https://github.com/kdheepak/panvimdoc>

vim:tw=78:ts=8:noet:ft=help:norl:
