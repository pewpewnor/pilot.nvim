*pilot.txt*     Run your projects and files with powerful command placeholders

==============================================================================
Table of Contents                                    *pilot-table-of-contents*

  - Features                                                  |pilot-features|
  - Installation                                          |pilot-installation|
  - General Terms                                        |pilot-general-terms|
  - Default Configuration Values          |pilot-default-configuration-values|
  - Configuration Options                        |pilot-configuration-options|
  - Example Customization                        |pilot-example-customization|
  - Run Configuration Format                  |pilot-run-configuration-format|
  - Example Project Run Config              |pilot-example-project-run-config|
  - Example File Type Run Config          |pilot-example-file-type-run-config|
  - Placeholders                                          |pilot-placeholders|
  - Preset Executors                                  |pilot-preset-executors|
  - Functions                                                |pilot-functions|
  - Tips & Recommendations                      |pilot-tips-&-recommendations|
  - FAQ                                                            |pilot-faq|


A Neovim plugin that allows you to **run** your **project or file** based on a
**JSON run configuration file** with placeholder support and customizable
executors. You can edit configurations on the fly, and the plugin supports
advanced features like checks for possible config paths, custom executors, and
more.

This plugin requires Neovim v0.11.0 at the minimum. We always strive to use the
latest Neovim major release version.

The source code for this plugin is available in the GitHub repository
<https://github.com/pewpewnor/pilot.nvim>.

------------------------------------------------------------------------------

FEATURES                                                      *pilot-features*

- **Run arbitrary commands** for any file or project, with full control over execution.
- **Placeholder interpolation** for file paths, names, directories, and more.
- **On-the-fly configuration editing**: No need to reload Neovim after changes.
- **Multiple run config paths**: It searches your list of possible run config path locations.
- **Customizable config file locations**: Store configs wherever you want.
- **Customizable executors**: Run commands in new tabs, splits, vsplits, background jobs, or your own custom way.
- **Custom executors**: Define your own ways to run commands, including integration with tools like tmux.
- **UI selection**: If multiple commands are available, select which to run via `vim.ui.select`.
- **Automatic single-command execution**: Optionally auto-run if only one command is available.
- **Purge/delete config files**: Easily remove or reset run configurations.
- **Import other config files**: Use `"import"` in your JSON to include commands from other files.
- **JSON validation and helpful errors**: Clear error messages for misconfigured files.
- **Template writing**: Optionally auto-generate a template when creating a new config file.
- **Full Lua API**: All features are accessible programmatically.

------------------------------------------------------------------------------

INSTALLATION                                              *pilot-installation*

Using lazy.nvim <https://github.com/folke/lazy.nvim>:

>lua
    return {
        "pewpewnor/pilot.nvim",
        opts = {},
    }
    -- or
    return {
        "pewpewnor/pilot.nvim",
        config = function()
            require("pilot").setup()
        end,
    }
<

Using packer.nvim <https://github.com/wbthomason/packer.nvim>:

>lua
    use {
        "pewpewnor/pilot.nvim",
        config = function()
            require("pilot").setup()
        end
    }
<

------------------------------------------------------------------------------

GENERAL TERMS                                            *pilot-general-terms*

- **Project run configuration**: JSON file containing commands to run for the current project.
- **File type run configuration**: JSON file containing commands to run for the current file type.

------------------------------------------------------------------------------

DEFAULT CONFIGURATION VALUES              *pilot-default-configuration-values*

>lua
    {
        run_config_path = {
            project = function()
                return vim.fs.joinpath("{{pilot_data_path}}", "projects", "{{hash_sha256(cwd_path)}}.json")
            end, -- function(): string? | (function(): string?)[]
            file_type = function()
                return vim.fs.joinpath("{{pilot_data_path}}", "filetypes", "{{file_type}}.json")
            end, -- function(): string? | (function(): string?)[]
        },
        auto_run_single_command = {
            project = true, -- boolean
            file_type = true, -- boolean
        },
        write_template_to_new_run_config = true, -- boolean
        default_executor = {
            project = pilot.preset_executors.new_tab, -- function(command: string)
            file_type = pilot.preset_executors.new_tab, -- function(command: string)
        },
        executors = {
            new_tab = pilot.preset_executors.new_tab,
            current_buffer = pilot.preset_executors.current_buffer,
            split = pilot.preset_executors.split,
            vsplit = pilot.preset_executors.vsplit,
            print = pilot.preset_executors.print,
            silent = pilot.preset_executors.silent,
            background_silent = pilot.preset_executors.background_silent,
            background_exit_status = pilot.preset_executors.background_exit_status,
        }, -- table<string, function(command: string, args: string[])>
        placeholders = {
            vars = {
                file_path = function()
                    return vim.fn.fnameescape(vim.fn.expand("%:p"))
                end,
                file_path_relative = function()
                    return vim.fn.fnameescape(vim.fn.expand("%"))
                end,
                file_name = function()
                    return vim.fn.fnameescape(vim.fn.expand("%:t"))
                end,
                file_name_no_extension = function()
                    return vim.fn.fnameescape(vim.fn.expand("%:t:r"))
                end,
                file_type = function()
                    return vim.bo.filetype
                end,
                file_extension = function()
                    return vim.fn.fnameescape(vim.fn.expand("%:e"))
                end,
                dir_path = function()
                    return vim.fn.fnameescape(vim.fn.expand("%:p:h"))
                end,
                dir_name = function()
                    return vim.fn.fnameescape(vim.fn.expand("%:p:h:t"))
                end,
                cwd_path = function()
                    return vim.fn.fnameescape(vim.fn.getcwd())
                end,
                cwd_name = function()
                    return vim.fn.fnameescape(
                        vim.fn.fnamemodify(vim.fn.getcwd(), ":t")
                    )
                end,
                pilot_data_path = function()
                    local pilot_data_path =
                        vim.fs.joinpath(vim.fn.stdpath("data"), "pilot")
                    if vim.fn.isdirectory(pilot_data_path) == 0 then
                        vim.fn.mkdir(pilot_data_path, "p")
                    end
                    return vim.fn.fnameescape(pilot_data_path)
                end,
                cword = function()
                    return vim.fn.expand("<cword>")
                end,
                cWORD = function()
                    return vim.fn.expand("<cWORD>")
                end,
            },  -- table<string, function(): string>
            funcs = {
                hash_sha256 = function(arg)
                    return vim.fn.sha256(arg)
                end,
            },  -- table<string, function(arg: string): string>
        },
    }
<

------------------------------------------------------------------------------

CONFIGURATION OPTIONS                            *pilot-configuration-options*


RUN_CONFIG_PATH.PROJECT ~

- **Type:** `function(): string? | (function(): string?)[]`
- **Description:**
    Path or list of paths to the project run configuration file(s).
    If it’s a list, the first existant & readable file will be used.
    Supports placeholders (see |pilot-placeholders|).
- **Example:**
    `"{{cwd_path}}/pilot.json"`
    `{ "{{cwd_path}}/pilot.json", "{{cwd_path}}/.pilot.json" }`


RUN_CONFIG_PATH.FILE_TYPE ~

- **Type:** `function(): string? | (function(): string?)[]`
- **Description:**
    Path or list of paths to the file type run configuration file(s).
    If it’s a list, the first existant & readable file will be used.


AUTO_RUN_SINGLE_COMMAND.PROJECT ~

- **Type:** `boolean`
- **Description:**
    If only one command is found in the project run config, run it immediately without prompting the user.


AUTO_RUN_SINGLE_COMMAND.FILE_TYPE ~

- **Type:** `boolean`
- **Description:**
    If only one command is found in the filetype run config, run it immediately without prompting the user.


WRITE_TEMPLATE_TO_NEW_RUN_CONFIG ~

- **Type:** `boolean`
- **Description:**
    If true, writes a JSON template when creating a new config file (when editing a config that does not exist).


DEFAULT_EXECUTOR.PROJECT ~

- **Type:** `function(command: string) -> string`
- **Description:**
    The default executor function used to run commands which have no specified `executor` in the project run config.
    See |pilot-preset-executors| for available executors and their signatures.


DEFAULT_EXECUTOR.FILE_TYPE ~

- **Type:** `function(command: string) -> string`
- **Description:**
    The default executor function used to run commands which have no specified `executor` in the filetype run config.
    See |pilot-preset-executors| for available executors and their signatures.


EXECUTORS ~

- **Type:** `table<string, function(command: string, args: string[])>`
- **Description:**
    Table mapping executor names to executor functions.
    Used when a run config entry specifies a `"executor"` field.
    The executor function receives two arguments:
    - `command` (string): The shell command to run (with placeholders already expanded).
    - `args` (list of strings): The result from splitting the string that was written in the `executor` with whitespaces as the seperator and without the executor name (first argument) inside the list.


PLACEHOLDERS ~

- **Type:** `table` with `vars` and `funcs` subtables
- **Description:**
- `vars` is a table mapping placeholder names to functions that return strings (e.g. `file_name`).
- `funcs` is a table mapping placeholder function names to functions that accept an argument and return a string (e.g. `hash_sha256`).

------------------------------------------------------------------------------

EXAMPLE CUSTOMIZATION                            *pilot-example-customization*

>lua
    local pilot = require("pilot")
    pilot.setup({
        run_config_path = {
            -- grab the pilot configuration from the current working directory instead
            -- of automatically generating one
            project = {
                function() return "{{cwd_path}}/pilot.json" end,
                -- these will be checked if our above "pilot.json" file doesn't exist
                function() return "{{cwd_path}}/.vscode/pilot.json" end,
                function()
                    if vim.fn.filereadable(vim.fn.getcwd() .. "/package-lock.json") == 1 then
                        return "{{pilot_data_path}}/npm_project.json"
                    end
                end,
            },
        },
        default_executor = {
            file_type = pilot.preset_executors.split,
        },
        write_template_to_new_run_config = false,
        executors = {
            tmux_new_window = function(command, args)
                vim.fn.system("tmux new-window -d")
                vim.fn.system("tmux send-keys -t +. '" .. command .. "' Enter")
            end,
            background = pilot.preset_executors.background_exit_status,
        },
        placeholders = {
            vars = {
                -- example to add custom placeholders
                new_temp_file = function() return vim.fn.tempname() end,
                template_path = function() return pilot.utils.interpolate("{{pilot_data_path}}/templates") end,
            },
            funcs = {},
        },
    })
    
    vim.keymap.set("n", "<F10>", pilot.run_project)
    vim.keymap.set("n", "<F12>", pilot.run_file_type)
    vim.keymap.set("n", "<F11>", pilot.run_previous_task)
    vim.keymap.set("n", "<Leader><F10>", pilot.edit_project_run_config)
    vim.keymap.set("n", "<Leader><F12>", pilot.edit_file_type_run_config)
    
    vim.api.nvim_create_user_command("PilotDeleteProjectRunConfig",
        pilot.delete_project_run_config, { nargs = 0, bar = false })
    vim.api.nvim_create_user_command("PilotDeleteFileTypeRunConfig",
        pilot.delete_file_type_run_config, { nargs = 0, bar = false })
<

------------------------------------------------------------------------------

RUN CONFIGURATION FORMAT                      *pilot-run-configuration-format*

Both project and file type run configurations use the same JSON format: an
array of entries.

Each entry can be:

- A **string** (the command to run)
- An **object** with fields:
    - `name` (optional): Display name for the command.
    - `command`: String or array of strings (joined with `&&`).
    - `executor` (optional): Name of an executor that exists in |pilot-executors|.
    - `import` (optional): Path to another JSON file to import entries from.
        Imported entries are merged in place.

------------------------------------------------------------------------------

EXAMPLE PROJECT RUN CONFIG                  *pilot-example-project-run-config*

>json
    [
        {
            "name": "build & run project",
            "command": "make build && make run"
        },
        {
            "name": "run hovered test function name",
            "command": "go test -v --run {{cword}}"
        },
        {
            "command": ["ls {{dir_path}}", "touch 'hello world.txt'"],
            "executor": "tmux_new_window"
        },
        "echo Hello, World!"
    ]
<


  **Tip:** Use the mustache syntax like `{{cword}}` to insert a placeholder that
  will automatically be replaced by pilot.nvim on the fly!
------------------------------------------------------------------------------

EXAMPLE FILE TYPE RUN CONFIG              *pilot-example-file-type-run-config*

Let’s say you want to write a file type run configuration for compiling and
running C source code files.

>json
    [
        {
            "name": "clang",
            "command": "clang {{file_path_relative}} && ./a.out"
        },
        "gcc {{file_path}} -o {{file_name_no_extension}} ; ./{{file_name_no_extension}}"
    ]
<


  **Tip:** For each entry, you don’t have to specify a display name if you want
  it to be the same as the raw command string. You can also instead use a string
  for defining an entry/command.
**Importing/Including Existing Run Configuration:**

>json
    [{ "import": "{{pilot_data_path}}/common_commands.json" }]
<

------------------------------------------------------------------------------

PLACEHOLDERS                                              *pilot-placeholders*

All placeholders are expanded in config paths and commands. You can escape a
placeholder by using triple braces, e.g. `{{{not_a_placeholder}}}`.

**Variables**

Simple placeholders that expand to a string. Define them in `placeholders.vars`
as functions that return a string, and use them as `{{name}}` in config paths
or commands.

  --------------------------------------------------------------------------------
  Placeholder                  Resolved value
  ---------------------------- ---------------------------------------------------
  {{file_path}}                Current buffer’s absolute file path

  {{file_path_relative}}       File path relative to current working directory

  {{file_name}}                File name (with extension)

  {{file_name_no_extension}}   File name without extension

  {{file_type}}                Filetype of current buffer (vim.bo.filetype)

  {{file_extension}}           File extension

  {{dir_path}}                 Directory containing the current buffer

  {{dir_name}}                 Name of the directory containing the current buffer

  {{cwd_path}}                 Absolute path of the current working directory

  {{cwd_name}}                 Name of the current working directory

  {{config_path}}              Absolute path to your Neovim configuration
                               directory

  {{data_path}}                Absolute path to Neovim plugins data directory

  {{pilot_data_path}}          Absolute path to the pilot directory inside of
                               Neovim plugins data directory

  {{cword}}                    Word under the cursor

  {{cWORD}}                    WORD under the cursor
  --------------------------------------------------------------------------------
**Functions**

Callable placeholders that accept an argument and return a string. Define them
in `placeholders.funcs` as functions that accept a single argument and return a
string, and use them like `{{name(arg)}}` in configs.

  ------------------------------------------------------------------------------
  Placeholder            Description / usage
  ---------------------- -------------------------------------------------------
  {{hash_sha256(...)}}   SHA256 hash of the supplied path or string
                         (e.g. {{hash_sha256(cwd_path)}}).

  ------------------------------------------------------------------------------
Add custom vars to `placeholders.vars` and custom functions to
`placeholders.funcs`.

------------------------------------------------------------------------------

PRESET EXECUTORS                                      *pilot-preset-executors*

Executors are functions that run the command in a specific way. All executors
receive two arguments:

- `command` (string): The shell command to run (with placeholders already expanded).
- `args` (table): List of arguments (see |pilot-executors|).


BUILT-IN EXECUTORS ~

  --------------------------------------------------------------------------------------------------------------
  Executor                                        Description                                             
  ----------------------------------------------- ------------------------------------------------------- ------
  pilot.preset_executors.new_tab (default)        Run the command in a new Neovim tab. Uses               
                                                  :tabnew                              | term <cmd>.      

  pilot.preset_executors.current_buffer           Run the command in the current buffer (replaces buffer  
                                                  with terminal).                                         

  pilot.preset_executors.split                    Run the command in a new horizontal split               
                                                  (:split                              | term <cmd>).     

  pilot.preset_executors.vsplit                   Run the command in a new vertical split                 
                                                  (:vsplit                               | term <cmd>).   

  pilot.preset_executors.print                    Run the command and print output to a message           
                                                  (blocking, uses vim.fn.system).                         

  pilot.preset_executors.silent                   Run the command silently (blocking, no output shown).   

  pilot.preset_executors.background_silent        Run the command as a background job (no output, uses    
                                                  vim.fn.jobstart).                                       

  pilot.preset_executors.background_exit_status   Run as background job, print exit status on completion. 
  --------------------------------------------------------------------------------------------------------------

CUSTOM EXECUTORS ~

You can define your own executor functions and add them to `executors`. The
executor function signature is:

>lua
    function(command: string, args: string[])
        -- implementation
    end
<

**Example:**

>lua
    executors = {
        tmux_new_window = function(command, args)
            vim.fn.system("tmux new-window -d")
            vim.fn.system("tmux send-keys -t +. '" .. command .. "' Enter")
        end,
        vsplit = require("pilot").executors.vsplit,
    }
<

------------------------------------------------------------------------------

FUNCTIONS                                                    *pilot-functions*

All functions are available via `require("pilot")`.

  ----------------------------------------------------------------------------------------------
  Function Name                                  Description
  ---------------------------------------------- -----------------------------------------------
  setup(options)                                 Configure pilot.nvim. See configuration options
                                                 (detailed).

  run_project()                                  Run a project command (from project run
                                                 config). Prompts if multiple commands.

  run_file_type()                                Run a file type command (from file type run
                                                 config). Prompts if multiple commands.

  run_previous_task()                            Re-run the last executed task (project or file
                                                 type).

  edit_project_run_config()                      Open the project run config for editing
                                                 (creates template if missing).

  edit_file_type_run_config()                    Open the file type run config for editing
                                                 (creates template if missing).

  delete_project_run_config()                    Delete the current project run config file.

  delete_file_type_run_config()                  Delete the current file type run config file.

  purge_all_default_project_run_config_dir()     Delete all default project run config files (in
                                                 {{pilot_data_path}}/projects).

  purge_all_default_file_type_run_config_dir()   Delete all default file type run config files
                                                 (in {{pilot_data_path}}/filetypes).
  ----------------------------------------------------------------------------------------------
------------------------------------------------------------------------------

TIPS & RECOMMENDATIONS                          *pilot-tips-&-recommendations*

- Use telescope-ui-select.nvim <https://github.com/nvim-telescope/telescope-ui-select.nvim> or mini.nvim’s mini-pick <https://github.com/echasnovski/mini.nvim/blob/main/readmes/mini-pick.md> for a better `vim.ui.select()` experience.
- You can import common commands into multiple configs using the `"import"` key.
- Placeholders can be escaped by using extra braces, e.g. `{{{not_a_placeholder}}}`.
- To disable template writing for new configs, set `write_template_to_new_run_config = false`.
- All config files are validated on load; errors are shown in the command line.

------------------------------------------------------------------------------

FAQ                                                                *pilot-faq*

**Q: How do I add a new executor?** A: Add a function to `executors` in your
config and reference its key in your run config’s `"executor"`.

**Q: How do I use placeholders in config paths?** A: All config paths support
placeholders like `{{cwd_path}}`, `{{file_type}}`, etc.

**Q: Can I use arrays for the command field?** A: Yes, arrays are joined with
`&&` to form a single shell command.

**Q: What is passed to custom executors?** A: Both the expanded command string
and an `arg` string (see |pilot-preset-executors|).

Q: How do I contribute to this project? A: See CONTRIBUTING.md
<../CONTRIBUTING.md> for guidelines.

------------------------------------------------------------------------------

Generated by panvimdoc <https://github.com/kdheepak/panvimdoc>

vim:tw=78:ts=8:noet:ft=help:norl:
